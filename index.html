<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Burza uƒçebnic ‚Äì Skener</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: #f5f5f5;
      margin: 0;
      padding: 20px;
      text-align: center;
    }

    h1 {
      font-size: 1.6em;
      margin-bottom: 15px;
      color: #ffffff;
    }

    input {
      padding: 12px;
      font-size: 1.1em;
      width: 80%;
      max-width: 320px;
      border: 2px solid #333;
      border-radius: 10px;
      background-color: #1e1e1e;
      color: #fff;
      outline: none;
      transition: border 0.2s;
    }

    input:focus {
      border-color: #4dabf7;
    }

    button {
      margin-top: 15px;
      padding: 12px 20px;
      font-size: 1.1em;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      background: linear-gradient(135deg, #4dabf7, #1971c2);
      color: white;
      font-weight: bold;
      transition: transform 0.15s, opacity 0.15s;
    }

    button:active {
      transform: scale(0.96);
      opacity: 0.9;
    }

    #result {
      margin-top: 20px;
      padding: 15px;
      border-radius: 12px;
      background-color: #1e1e1e;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      display: none;
      text-align: left;
    }

    .book-image {
      max-width: 120px;
      margin: 10px auto;
      display: block;
      border-radius: 6px;
    }

    .status {
      font-weight: bold;
      margin: 8px 0;
    }

    .status.available {
      color: #69db7c;
    }

    .status.sold {
      color: #ff6b6b;
    }

    .mark-btn {
      margin-top: 12px;
      background: linear-gradient(135deg, #ff6b6b, #c92a2a);
    }
  </style>
</head>
<body>
  <h1>üìö Burza uƒçebnic</h1>
  <input type="text" id="codeInput" placeholder="Zadejte k√≥d">
  <button onclick="searchBook()">Vyhledat</button>

  <div id="result"></div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbwIRLHu_Due8r2F5kW84lYtejdks7hzS0Y_8j3Pv4WDgU-dC1sTVUU2YYDFqcPON_bMzg/exec";

    async function searchBook() {
      const code = document.getElementById("codeInput").value.trim();
      if (!code) return;

      const res = await fetch(`${API_URL}?code=${encodeURIComponent(code)}`);
      const book = await res.json();

      const resultDiv = document.getElementById("result");
      resultDiv.style.display = "block";

      if (!book) {
        resultDiv.innerHTML = "<p>‚ùå Uƒçebnice nenalezena.</p>";
        return;
      }

      const isSold = book.status.toLowerCase() === "prodano";
      const statusClass = isSold ? "sold" : "available";

      resultDiv.innerHTML = `
        <h3>${book.title}</h3>
        ${book.image ? `<img src="${book.image}" class="book-image">` : ""}
        <p><strong>Majitel:</strong> ${book.owner} (${book.class})</p>
        <p><strong>Email:</strong> ${book.email}</p>
        <p><strong>Cena:</strong> ${book.price} Kƒç (+${book.fee} Kƒç p≈ôir√°≈æka)</p>
        <p class="status ${statusClass}">
          Stav: ${book.status}
        </p>
        ${!isSold ? 
          `<button class="mark-btn" onclick="markAsSold('${book.code}')">Oznaƒçit jako prodan√©</button>` 
          : ""}
      `;
    }

    async function markAsSold(code) {
      const res = await fetch(`${API_URL}?code=${encodeURIComponent(code)}&action=markAsSold`);
      const data = await res.json();
      alert(data.message);
      searchBook(); // obnov√≠ info po zmƒõnƒõ stavu
    }
  </script>
</body>
</html>
